# Task 3.2: Recipe & Item Query API

**Phase**: 3 - Recipe Management API
**Status**: Not Started

## Summary

Endpoints for querying recipes and items by various criteria.

## Why This Matters

The flowchart editor needs to look up recipes to build chains, and display item information with proper names, tooltips, and icons.

## Inputs/Outputs

- **Input**: Query parameters (item ID, recipe type, search term)
- **Output**: Matching recipes with full data, items with metadata

## Technical Notes

### Endpoints

#### 1. List recipes with filters

`GET /api/modpacks/:slug/versions/:version/recipes`

Query params: `?outputItem=...&inputItem=...&type=...&machineType=...&page=1&limit=50`

**Response**:
```json
{
  "recipes": [
    {
      "id": "gtceu:chemical_reactor/sodium_hydroxide",
      "type": "gregtech:machine",
      "machineType": "chemical_reactor",
      "voltageTier": "LV",
      "euPerTick": 30,
      "duration": 100,
      "circuit": 1,
      "inputs": {
        "items": [{"itemId": "gtceu:sodium_dust", "count": 1}],
        "fluids": [{"fluidId": "minecraft:water", "amount": 1000}]
      },
      "outputs": {
        "items": [{"itemId": "gtceu:sodium_hydroxide_dust", "count": 1}],
        "fluids": [{"fluidId": "gtceu:hydrogen", "amount": 1000}]
      }
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 50,
    "total": 234,
    "pages": 5
  }
}
```

#### 2. Get recipes for specific item

`GET /api/modpacks/:slug/versions/:version/recipes/by-output/:itemId`

Returns all recipes that produce this item.

`GET /api/modpacks/:slug/versions/:version/recipes/by-input/:itemId`

Returns all recipes that use this item as input.

#### 3. Search items

`GET /api/modpacks/:slug/versions/:version/items/search`

Query params: `?q=sodium+hydroxide`

**Response**:
```json
{
  "items": [
    {
      "itemId": "gtceu:sodium_hydroxide_dust",
      "displayName": "Sodium Hydroxide Dust",
      "tooltip": ["Chemical Formula: NaOH", "Melting Point: 596K"],
      "iconUrl": "/api/icons/gtceu_sodium_hydroxide_dust.png"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 3
  }
}
```

#### 4. Get single item

`GET /api/modpacks/:slug/versions/:version/items/:itemId`

**Response**:
```json
{
  "itemId": "gtceu:sodium_hydroxide_dust",
  "displayName": "Sodium Hydroxide Dust",
  "tooltip": ["Chemical Formula: NaOH", "Melting Point: 596K"],
  "iconUrl": "/api/icons/gtceu_sodium_hydroxide_dust.png",
  "recipesAsOutput": 3,
  "recipesAsInput": 12
}
```

#### 5. Get item icon

`GET /api/icons/:filename`

Returns the icon image (PNG or WebP).

### Features

- Support filters: input item, output item, machine type, voltage tier
- Pagination for large result sets
- Include recipe metadata for GT calculations (circuit, EU/t, duration)
- Return icon URLs with items
- Search by display name (not just itemId)
- Full-text search on item names

### Search Implementation

- Index `displayName` for full-text search
- Also match on `itemId` for exact matches
- Consider fuzzy matching for typos

## Files to Touch

- `packages/api/src/routes/recipes.ts`
- `packages/api/src/routes/items.ts`
- `packages/api/src/routes/icons.ts`
- `packages/api/src/services/recipeQuery.ts`
- `packages/api/src/services/itemQuery.ts`

## Acceptance Criteria

- [ ] Can query recipes by output item
- [ ] Can query recipes by input item
- [ ] Can filter recipes by machine type
- [ ] Can filter recipes by voltage tier
- [ ] **Search returns items by display name**
- [ ] **Item responses include displayName and tooltip**
- [ ] **Icon URLs work and return images**
- [ ] Pagination works correctly
- [ ] GregTech metadata included in responses (circuit, EU/t, duration)
- [ ] Full-text search on item names works
